#ansible 

Переменные используются для хранения информации, которая может изменяться от одного выполнения плейбука к другому или от одного окружения к другому. Это делает [[Ansible]] более гибким и повторно используемым. Существует несколько способов определения и использования переменных в Ansible:

1. **Переменные в инвентарных файлах**

Можно задать непосредственно в инвентарном файле. Это могут быть файлы в форматах INI или YAML. Пример в формате INI:

```ini
[webservers]
webserver1 ansible_host=192.168.1.100 http_port=80 max_requests=1000
```

В YAML формате это будет выглядеть так:

```yaml
webservers:
  hosts:
    webserver1:
      ansible_host: 192.168.1.100
      http_port: 80
      max_requests: 1000
```

2. **Файлы переменных в плейбуках**

Могут быть организованы в файлы, обычно YAML, которые затем подключаются к плейбукам через директиву **`vars_files`**. Пример использования в плейбуке:

```yaml
---
- hosts: all
  vars_files:
    - vars/main.yml
```

Где **`vars/main.yml`** содержит:

```yaml
http_port: 80
max_requests: 1000
```

3. **Переменные в командной строке**

Могут быть определены непосредственно при запуске плейбука через командную строку с помощью ключа **`-e`** или **`--extra-vars`**. Пример:

```bash
ansible-playbook playbook.yml -e "http_port=80 max_requests=1000"
```

4. **Переменные в плейбуках**

Можно определить непосредственно в плейбуке под ключом **`vars`**:

```yaml
---
- hosts: all
  vars:
    http_port: 80
    max_requests: 1000
```

5. **Role Defaults и Vars**

Каждая роль может иметь файлы **`defaults/main.yml`** и **`vars/main.yml`**. Переменные, определенные в **`defaults`**, имеют самый низкий приоритет и могут быть переопределены почти в любом месте. Переменные в **`vars`** имеют более высокий приоритет и переопределяются с трудом.

6. **Registered Variables**

Переменные могут быть созданы во время выполнения плейбука с использованием модулей и зарегистрированы для использования в последующих задачах. Например:

```yaml
- name: Get the date
  command: date
  register: current_date
```

7. **[[Что такое факты в Ansible|Facts (факты)]]**

Собираются Ansible автоматически при выполнении плейбука и содержат информацию о удалённых системах. Facts можно использовать как переменные:

```yaml
---
- hosts: all
  tasks:
    - name: Print OS family
      debug:
        msg: "The OS family is {{ ansible_os_family }}"
```

Каждый из этих способов имеет своё применение в зависимости от требований задачи, структуры данных и логики плейбука. Правильный выбор способа определения переменных помогает создать более читаемые, поддерживаемые и масштабируемые Ansible плейбуки и роли.