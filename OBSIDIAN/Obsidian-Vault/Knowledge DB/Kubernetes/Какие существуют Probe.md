#kubernetes 

**Probe** — это диагностические инструменты, используемые для проверки состояния [[В чем разница между подом и контейнером|контейнеров в подах]]. [[Kubernetes]] поддерживает три типа проб: **Liveness Probes**, **Readiness Probes** и **Startup Probes**. Эти механизмы позволяют Kubernetes автоматически управлять контейнерами в зависимости от их текущего состояния, что обеспечивает большую надежность и доступность приложений.

1. Liveness Probe  
Используется для определения, когда перезапустить контейнер. Эти пробы помогают уловить ситуации, когда приложение запущено, но не может корректно функционировать (например, зациклилось или зависло). Если liveness probe для контейнера возвращает ошибку, Kubernetes понимает, что контейнер не работает исправно, и инициирует его перезапуск.

2. Readiness Probe  
Определяет, готов ли контейнер к обработке трафика. Это важно для случаев, когда приложение запущено, но ещё не готово принимать запросы. Например, приложение может загружать большой объем данных или компилировать какой-то код при старте. Если readiness probe не проходит, то значит, контейнер не готов к работе, и Kubernetes не будет направлять трафик на такой под.

3. Startup Probe  
Используется для определения того, когда приложение в контейнере было запущено. Этот тип пробы полезен для приложений, которые имеют длительный процесс инициализации. Если приложение требует больше времени для старта, чем обычно, startup probe позволяет предотвратить излишние перезапуски контейнера, которые могли бы происходить, если бы использовались только liveness и readiness probes.

Конфигурация  
Пробы можно настроить с использованием различных методов, таких как HTTP GET запросы, TCP Socket соединения или выполнение команды в контейнере. Вот примеры конфигурации каждого типа пробы в манифесте пода на YAML:

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: myapp-pod
spec:
  containers:
  - name: myapp-container
    image: myapp:1.0
    livenessProbe:
      httpGet:
        path: /healthz
        port: 8080
      initialDelaySeconds: 15
      timeoutSeconds: 2
      periodSeconds: 5
      failureThreshold: 3
    readinessProbe:
      exec:
        command:
        - cat
        - /tmp/ready
      initialDelaySeconds: 5
      periodSeconds: 5
    startupProbe:
      tcpSocket:
        port: 8080
      initialDelaySeconds: 10
      periodSeconds: 10
```

Пробы предоставляют жизненно важные механизмы для контроля и управления жизненным циклом контейнеров, обеспечивая высокую доступность и надежность микросервисов. Правильное использование liveness, readiness и startup probes помогает поддерживать стабильную и эффективную работу приложений в кластере Kubernetes.